<template>
    <v-dialog v-model="enabled" max-width="800px" v-if="vulnerability">
            <v-card>
                <v-card-title class="text-h5">
                    Vulnerability
                    <v-spacer></v-spacer>
                    <v-chip class="ma-2">{{ vulnerability.tool }}</v-chip>
                    <VulnerabilityChip :vulnerability="vulnerability" />
                    <v-btn depressed @click="close()">Close</v-btn>
                </v-card-title>
                <v-card-text class="card-title-item">
                   <v-simple-table>
                    <template v-slot:default>
                        <tbody>
                            <tr>
                                <td>File</td>
                                <td><a :href="vulnerability.vulnerability_url">{{ vulnerability.path }}</a></td>
                            </tr>
                            <tr>
                                <td>Rule</td>
                                <td>{{ vulnerability.rule }}</td>
                            </tr>
                            <tr>
                                <td>Details</td>
                                <td>{{ vulnerability.details }}</td>
                            </tr>
                            <tr>
                                <td>Commit</td>
                                <td>{{ vulnerability.commit_id }}</td>
                            </tr>
                            <tr>
                                <td>Author</td>
                                <td>{{ vulnerability.author_email }}</td>
                            </tr>
                        </tbody>
                    </template>
                </v-simple-table>
                <code v-if="getCode() != ''">
                    {{ getCode() }}
                </code>
              </v-card-text>
            </v-card> 
        </v-dialog>
</template>

<script>
import VulnerabilityChip from '@/components/base/VulnerabilityChip'
export default {
    name: "VulnerabilityViewer",
    components: {
      VulnerabilityChip,
    },
    props: ['close', 'enabled', 'vulnerability', 'uuid'],
    watch: {
        uuid: {
            handler () {
                this.loadVulnerabilityInformations()
            }
        }
    },
    methods: {
        loadVulnerabilityInformations() {
            if(this.uuid != undefined) {
                var that = this;
                this.$api.get("/vulnerabilities/"+this.uuid).then(
                    response => {
                        that.vulnerability = response.data
                })
            }
            
        },
        getCode() {
            try {
                return this.vulnerability.locations[0].physicalLocation.region.snippet.text
            } catch {
                return ""
            }
            
            
        }
    }
    }
</script>